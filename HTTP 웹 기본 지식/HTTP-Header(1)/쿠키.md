## 쿠키
쿠키를 사용할 때는 2개의 헤더를 사용한다.

- Set-Cookie: 서버에서 클라이언트로 쿠키 전달(응답)
- Cookie: 클라이언트가 서버에서 쿠키를 저장하고, HTTP 요청시 서버로 전달

### 쿠키를 사용하지 않았을 때

1. 클라이언트가 /welcome페이지에 접속해서 안녕하세요 손님이라고 응답을 받았고


2. 정보를 보내서 로그인요청을 해서 로그인했다.


3. 이 상태에서 다시 /welcome페이지로 간다면?

   안녕하세요 손님이라고 또 응답을 받는다.



이유: 서버입장에서는 로그인한 유저였는지 구분할 방법이 없다.

(HTTP는 전송이 끝나면 연결을 끝낸다. 그렇기 때문에 구분할 수 있는 방법이 없다. )

### Stateless


- HTTP는 무상태 프로토콜
- 클라이언트와 서버가 요청과 응답을 주고 받으면 연결이 끊어지기 때문에 클라이언트가 다시 요청하면 서버는 이전 요청을 기억하지 못한다. 클라이언트와 서버는 서로 상태를 유지하지 않는다.

해결하려면??

대안 - 클라이언트가 보내는 모든 요청에 사용자 정보를 포함하면 된다.



근데 이 대안은 개발적으로 힘들고 보안을 포함한 문제들이 발생할 수 있다.


이를 해결하기 위해 쿠키를 사용한다.

### 쿠키 사용하면


1. 웹브라우저가 로그인요청을 보내면
2. 서버는 Set-Cookie에 유저 정보를 넣어서 응답을 한다.
3. 그러면 웹브라우저는 쿠키 저장소에 서버가 응답해서 만든 값을 저장한다.

로그인 이후 유저가 welcome 페이지를 접근하면?


1. 해당 서버에 요청을 할 때 자동으로 웹브라우저는 쿠키 저장소를 조회해서 Cookie라는 헤더를 만들어서 보낸다.
2. 서버는 클라이언트가 보낸 쿠키를 통해 유저를 식별할 수 있고 그에 맞게 응답을 한다.

쿠키는 지정한 서버에 대해서는 모든 요청에 쿠키 정보를 자동으로 포함한다.


근데 모든 곳에 보내면 보안에 취약해질 수 있기 때문에


- 주로 사용자 로그인 세션 관리할 때 자주 사용한다.
    - **sessionId -** 서버가 Set-Cookie에 user정보를 바로 보내는 건 보안에 위험하기 때문에 서버에서는 로그인이 성공하면 세션키를 만들어서 서버의 DB에 저장해놓고 세션값을 Set-Cookie에 넣어서 클라이언트한테 반환해준다.
    - 광고 정보 트래킹
- 쿠키 정보는 항상 서버에 전송된다.
    - 네트워크 트래픽을 추가적으로 유발할 수 있다.
    - 그렇기 때문에 최소한의 정보만 사용(세션 id, 인증 토큰)
    - 서버에 전송하지 않고, 웹 브라우저 내부에 데이터를 저장하고 필요할 때만 전송하고 싶다면 웹 스토리지를 참고
- 주의!
    - **보안에 민감한 데이터는 저장하면 안된다!!(주민번호, 신용카드 번호 등등)**


### 쿠키 - 생명주기 (Expires, max-age)


쿠키를 무제한 보관할 수는 없기 때문에

- Set-Cookie: expires를 통해 만료일이 되면 쿠키를 삭제할 수 있도록 할 수 있다.
- max-age는 초 단위로 셋팅이 가능
- 쿠키는 2가지 종류가 있다.
    - 세션 쿠키: 만료 날짜를 생략하면 브라우저 종료시 까지만 유지
    - 영속 쿠키: 만료 날짜를 입력하면 해당 날짜까지 유지


### 쿠키 - 도메인 (Domain)


내가 설정한 쿠키가 아무 사이트에나 전송되면 안되기 때문에 도메인을 지정

- 명시: 명시한 문서 기준 도메인 + 서브 도메인 포함
- 생략: 현재 문서 기준 도메인만 적용

### 쿠키 - 경로(Path)


- 경로를 포함한 하위 경로 페이지만 쿠키 접근
- 일반적으로 path=/ 루트로 지정하는 편이다.

### 쿠키 - 보안 (Secure, HttpOnly, SameSite)

- Secure
    - 쿠키는 원래 http, https를 구분하지 않고 전송한다.
    - Secure를 적용하면 https인 경우에만 전송한다.
- HttpOnly
    - XSS 공격 방지
    - 자바스크립트에서 원래 접근가능한데 접근 불가(document.cookie)
    - HTTP 전송에만 사용
- SameSite
    - XSRF 공격 방지
    - 현재 내가 요청한 도메인과 쿠키에 설정된 도메인이 같은 경우만 쿠키 전송
    - 생긴지 얼마 안되었기 때문에 브라우저에서 지원여부를 잘 확인할 것