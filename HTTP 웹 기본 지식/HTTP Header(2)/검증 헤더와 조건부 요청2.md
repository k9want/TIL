# 검증 헤더와 조건부 요청 2


- 검증 헤더
    - 캐시 데이터와 서버 데이터가 같은지 검증하는 데이터
    - Last-Modified, ETag
- 조건부 요청 헤더
    - 검증 헤더로 조건에 따른 분기
    - If-Modified-Since: Last-Modified랑 사용
    - If-None-Match: ETag랑 사용
    - 조건이 만족하면 200 OK 아니면 304 Not Modified

### 예시


If-Modified-Since: 이후에 데이터가 수정되었는지 확인 (헷갈리지 않도록 이후로 수정되었니?라고 물어본다고 생각하자)

- 만약에 데이터가 미변경일 경우 - (아니 안 바꼈어~! Not Modified)
    - 캐시랑 서버 유효기간이 같다면? (아니~! 안 변했어!라고 답하니까)
    - 304 Not Modified라고 응답(수정이 안됐어 → 너의 캐시로 리다이렉션해서 그 데이터를 사용해라는 뜻), 헤더 데이터만 전송(Body X)
- 데이터가 바껴있다면? - (응 바꼈어 OK)
    - 200 OK , 모든 데이터 전송(Body 포함)


### Last-Modified, If-Modified-Since의 단점


- 초 단위로 캐시 조정이 불가능하다.
- 날짜 기반의 정해진 로직을 사용한다.
- 데이터를 수정하면 날짜가 다르지만, 같은 데이터를 수정해서 데이터 결과가 똑같은 경우(A → B로 수정했다가 다시 B → A로 수정해서 결국 A가 되었을 때)
- 서버에서 날짜(시간) 개념보다는 별도로 캐시 로직을 관리하고 싶은 경우에는 사용할 수 없다. → 그래서 나온 게 ETag, If-None-Match이다.

### ETag, If-None-Match


- 캐시 데이터의 임의의 고유한 버전 이름을 달아두고
- 데이터가 변경되면 이 이름을 바꾸어서 변경한다. (Hash를 다시 생성) - 참고로 해시는 파일이 동일하면 똑같은 결과값이 나온다.
- 단순하게 ETag만 보내서 같으면 유지, 다르면 다시 받기

## ETag를 사용할 경우

첫번째 요청으로 서버에서 ETag를 포함해서 응답하면


웹브라우저는 캐시를 저장하는 곳에 ETag값을 저장하고


캐시 유효 시간을 초과해서 두 번째 요청을 했을 때


웹 브라우저가 ETag를 가지고 있으면 If-None-Match에 ETag값을 보낸다.



### 매치가 된 경우 (수정이 안 된 경우)

**매치가 된 경우에는 데이터가 수정이 안 되었기 때문에 실패 304 Not Modified (당연히 HTTP Body가 없음)로 응답한다.**



웹브라우저는 내부적으로 캐시를 갱신하고 (유효 기간 ..) 응답 결과를 재사용한다.


캐시에서 조회한다.


### 정리

- 단순하게 ETag만 서버에 보내서 같으면 유지 다르면 받기
- **캐시 제어 로직을 서버에서 완전히 관리한다.**
    - 클라이언트는 그렇기 때문에 단순히 이 값을 서버에 제공한다.